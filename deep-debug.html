<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Debug - Language Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .debug-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .error { border-left-color: #f44336; }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        
        .log {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover { background: #1976D2; }
        
        .test-lang-selector {
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            padding: 20px 0;
            margin-top: 40px;
        }

        .footer-bottom-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-language-selector {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .language-label {
            color: #003366;
            font-size: 14px;
            font-weight: 500;
        }

        .language-dropdown-wrapper {
            position: relative;
        }

        .language-btn {
            background: white;
            color: #003366;
            border: 2px solid #003366;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: space-between;
        }

        .language-btn:hover {
            background: #003366;
            color: white;
        }

        .globe-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .dropdown-arrow {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .language-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            background: white;
            border: 2px solid #003366;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .language-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .language-option {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: #003366;
        }

        .language-option:hover {
            background-color: #f0f0f0;
        }

        .language-option.active {
            background-color: #003366;
            color: white;
        }

        .flag-icon {
            margin-right: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>üîç Deep Debug - Language Selector Issue</h1>
    
    <div class="debug-section">
        <h3>1. Environment Check</h3>
        <div id="envCheck"></div>
        <button onclick="checkEnvironment()">Check Environment</button>
    </div>
    
    <div class="debug-section">
        <h3>2. File Loading Test</h3>
        <div id="fileCheck"></div>
        <button onclick="checkFileLoading()">Test File Loading</button>
    </div>
    
    <div class="debug-section">
        <h3>3. DOM Element Test</h3>
        <div id="domCheck"></div>
        <button onclick="checkDOMElements()">Check DOM Elements</button>
    </div>
    
    <div class="debug-section">
        <h3>4. Event Binding Test</h3>
        <div id="eventCheck"></div>
        <button onclick="checkEventBinding()">Test Event Binding</button>
    </div>
    
    <div class="debug-section">
        <h3>5. Manual Click Test</h3>
        <div id="clickCheck"></div>
        <button onclick="manualClickTest()">Manual Click Test</button>
        <button onclick="forceToggleDropdown()">Force Toggle Dropdown</button>
    </div>
    
    <div class="debug-section">
        <h3>6. Real-time Event Log</h3>
        <div class="log" id="eventLog">Waiting for events...</div>
        <button onclick="clearEventLog()">Clear Log</button>
    </div>

    <!-- Test Language Selector -->
    <div class="test-lang-selector">
        <div class="footer-bottom-content">
            <p>Test Footer Content</p>
            <!-- Language Selector -->
            <div class="footer-language-selector">
                <label class="language-label">Language:</label>
                <div class="language-dropdown-wrapper">
                    <button class="language-btn" id="languageBtn">
                        <svg class="globe-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
                        </svg>
                        <span id="currentLanguageText">English</span>
                        <svg class="dropdown-arrow" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    
                    <div class="language-dropdown" id="languageDropdown">
                        <button class="language-option" data-lang="en">
                            <span class="flag-icon">üá∫üá∏</span>
                            English
                        </button>
                        <button class="language-option" data-lang="zh-cn">
                            <span class="flag-icon">üá®üá≥</span>
                            ÁÆÄ‰Ωì‰∏≠Êñá
                        </button>
                        <button class="language-option" data-lang="zh-tw">
                            <span class="flag-icon">üáπüáº</span>
                            ÁπÅÈ´î‰∏≠Êñá
                        </button>
                        <button class="language-option" data-lang="ja">
                            <span class="flag-icon">üáØüáµ</span>
                            Êó•Êú¨Ë™û
                        </button>
                        <button class="language-option" data-lang="de">
                            <span class="flag-icon">üá©üá™</span>
                            Deutsch
                        </button>
                        <button class="language-option" data-lang="it">
                            <span class="flag-icon">üáÆüáπ</span>
                            Italiano
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let eventLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] [${type.toUpperCase()}] ${message}`);
            updateEventLog();
            console.log(`[${timestamp}] ${message}`);
        }
        
        function updateEventLog() {
            document.getElementById('eventLog').textContent = eventLog.slice(-50).join('\n');
        }
        
        function clearEventLog() {
            eventLog = [];
            updateEventLog();
        }
        
        function updateSection(sectionId, content, className = '') {
            const section = document.getElementById(sectionId);
            section.innerHTML = content;
            section.className = className;
        }
        
        function checkEnvironment() {
            log('Checking environment...');
            let report = '';
            
            // Check JavaScript enabled
            report += '‚úÖ JavaScript is enabled\n';
            
            // Check console for errors
            report += `‚úÖ User Agent: ${navigator.userAgent}\n`;
            report += `‚úÖ Current URL: ${window.location.href}\n`;
            report += `‚úÖ Document ready state: ${document.readyState}\n`;
            
            // Check for global variables
            report += `${typeof window.I18nManager !== 'undefined' ? '‚úÖ' : '‚ùå'} I18nManager class available: ${typeof window.I18nManager}\n`;
            report += `${typeof window.i18n !== 'undefined' ? '‚úÖ' : '‚ùå'} window.i18n instance: ${typeof window.i18n}\n`;
            
            updateSection('envCheck', `<pre>${report}</pre>`, 'success');
            log('Environment check completed');
        }
        
        async function checkFileLoading() {
            log('Checking file loading...');
            let report = '';
            
            try {
                // Test loading i18n.js
                const i18nResponse = await fetch('js/i18n.js');
                report += `${i18nResponse.ok ? '‚úÖ' : '‚ùå'} i18n.js status: ${i18nResponse.status}\n`;
                
                // Test loading language files
                const langResponse = await fetch('lang/en.json');
                report += `${langResponse.ok ? '‚úÖ' : '‚ùå'} en.json status: ${langResponse.status}\n`;
                
                if (langResponse.ok) {
                    const langData = await langResponse.json();
                    report += `‚úÖ en.json contains ${Object.keys(langData).length} sections\n`;
                }
                
            } catch (error) {
                report += `‚ùå File loading error: ${error.message}\n`;
            }
            
            updateSection('fileCheck', `<pre>${report}</pre>`, report.includes('‚ùå') ? 'error' : 'success');
            log('File loading check completed');
        }
        
        function checkDOMElements() {
            log('Checking DOM elements...');
            let report = '';
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            const currentText = document.getElementById('currentLanguageText');
            const options = document.querySelectorAll('.language-option');
            
            report += `${languageBtn ? '‚úÖ' : '‚ùå'} Language button found: ${!!languageBtn}\n`;
            report += `${dropdown ? '‚úÖ' : '‚ùå'} Dropdown found: ${!!dropdown}\n`;
            report += `${currentText ? '‚úÖ' : '‚ùå'} Current text span found: ${!!currentText}\n`;
            report += `${options.length > 0 ? '‚úÖ' : '‚ùå'} Language options found: ${options.length}\n`;
            
            if (languageBtn) {
                report += `‚úÖ Button element type: ${languageBtn.tagName}\n`;
                report += `‚úÖ Button computed style display: ${getComputedStyle(languageBtn).display}\n`;
                report += `‚úÖ Button computed style visibility: ${getComputedStyle(languageBtn).visibility}\n`;
            }
            
            if (dropdown) {
                report += `‚úÖ Dropdown classes: ${dropdown.className}\n`;
                report += `‚úÖ Dropdown computed style display: ${getComputedStyle(dropdown).display}\n`;
                report += `‚úÖ Dropdown computed style opacity: ${getComputedStyle(dropdown).opacity}\n`;
            }
            
            updateSection('domCheck', `<pre>${report}</pre>`, report.includes('‚ùå') ? 'error' : 'success');
            log('DOM elements check completed');
        }
        
        function checkEventBinding() {
            log('Checking event binding...');
            let report = '';
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            
            if (!languageBtn || !dropdown) {
                report += '‚ùå Required elements not found for event binding\n';
                updateSection('eventCheck', `<pre>${report}</pre>`, 'error');
                return;
            }
            
            // Check if i18n system is initialized
            if (typeof window.i18n !== 'undefined' && window.i18n.bindExistingLanguageSelectorEvents) {
                report += '‚úÖ i18n system available\n';
                try {
                    window.i18n.bindExistingLanguageSelectorEvents();
                    report += '‚úÖ bindExistingLanguageSelectorEvents called successfully\n';
                } catch (error) {
                    report += `‚ùå bindExistingLanguageSelectorEvents error: ${error.message}\n`;
                }
            } else {
                report += '‚ùå i18n system not available or method missing\n';
                
                // Manual event binding as fallback
                report += 'üîß Setting up manual event binding...\n';
                
                languageBtn.onclick = function(e) {
                    log('MANUAL: Button clicked!');
                    e.preventDefault();
                    dropdown.classList.toggle('open');
                    report += '‚úÖ Manual click handler bound\n';
                };
                
                const options = dropdown.querySelectorAll('.language-option');
                options.forEach((option, i) => {
                    option.onclick = function(e) {
                        log(`MANUAL: Option ${i+1} clicked: ${this.getAttribute('data-lang')}`);
                        e.preventDefault();
                        dropdown.classList.remove('open');
                    };
                });
                
                report += `‚úÖ Manual option handlers bound: ${options.length}\n`;
            }
            
            updateSection('eventCheck', `<pre>${report}</pre>`, report.includes('‚ùå') ? 'warning' : 'success');
            log('Event binding check completed');
        }
        
        function manualClickTest() {
            log('Manual click test...');
            let report = '';
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            
            if (!languageBtn || !dropdown) {
                report += '‚ùå Elements not found\n';
                updateSection('clickCheck', `<pre>${report}</pre>`, 'error');
                return;
            }
            
            report += 'üîß Simulating button click...\n';
            
            // Get current state
            const beforeState = dropdown.classList.contains('open');
            report += `üìä Dropdown state before: ${beforeState ? 'OPEN' : 'CLOSED'}\n`;
            
            // Simulate click
            const event = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });
            
            languageBtn.dispatchEvent(event);
            
            // Check state after
            setTimeout(() => {
                const afterState = dropdown.classList.contains('open');
                report += `üìä Dropdown state after: ${afterState ? 'OPEN' : 'CLOSED'}\n`;
                report += `${beforeState !== afterState ? '‚úÖ' : '‚ùå'} State changed: ${beforeState !== afterState}\n`;
                
                updateSection('clickCheck', `<pre>${report}</pre>`, beforeState !== afterState ? 'success' : 'warning');
                log('Manual click test completed');
            }, 100);
        }
        
        function forceToggleDropdown() {
            log('Force toggling dropdown...');
            const dropdown = document.getElementById('languageDropdown');
            if (dropdown) {
                dropdown.classList.toggle('open');
                log(`Dropdown force toggled to: ${dropdown.classList.contains('open') ? 'OPEN' : 'CLOSED'}`);
            }
        }
        
        // Global event listeners for monitoring
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM Content Loaded');
            
            // Monitor all clicks
            document.addEventListener('click', function(e) {
                log(`Click on: ${e.target.tagName} #${e.target.id} .${e.target.className}`);
            });
            
            // Monitor specific elements
            const languageBtn = document.getElementById('languageBtn');
            if (languageBtn) {
                languageBtn.addEventListener('click', function() {
                    log('Language button click detected by monitor!');
                });
            }
        });
        
        // Load i18n script and monitor
        const script = document.createElement('script');
        script.src = 'js/i18n.js';
        script.onload = function() {
            log('i18n.js loaded successfully');
            
            // Try to initialize i18n
            setTimeout(async () => {
                try {
                    if (typeof I18nManager !== 'undefined') {
                        log('Creating I18nManager instance...');
                        window.i18n = new I18nManager();
                        
                        log('Initializing i18n...');
                        await window.i18n.init();
                        
                        log('i18n initialized successfully');
                    } else {
                        log('I18nManager class not found', 'error');
                    }
                } catch (error) {
                    log(`i18n initialization error: ${error.message}`, 'error');
                }
            }, 100);
        };
        script.onerror = function() {
            log('Failed to load i18n.js', 'error');
        };
        document.head.appendChild(script);
    </script>
</body>
</html>