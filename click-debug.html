<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Event Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .debug-info {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .log {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .test-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        /* ËØ≠Ë®ÄÈÄâÊã©Âô®Ê†∑Âºè */
        .footer-language-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .language-label {
            color: #003366;
            font-size: 14px;
            font-weight: 500;
        }

        .language-dropdown-wrapper {
            position: relative;
        }

        .language-btn {
            background: white;
            color: #003366;
            border: 2px solid #003366;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: space-between;
        }

        .language-btn:hover {
            background: #003366;
            color: white;
        }

        .globe-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .dropdown-arrow {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .language-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            background: white;
            border: 2px solid #003366;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .language-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .language-option {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: #003366;
        }

        .language-option:hover {
            background-color: #f0f0f0;
        }

        .flag-icon {
            margin-right: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>üîç Click Event Debug Test</h1>
    
    <div class="debug-info">
        <h3>Step-by-step Debug</h3>
        <button class="test-btn" onclick="step1_checkElements()">Step 1: Check Elements</button>
        <button class="test-btn" onclick="step2_checkI18n()">Step 2: Check i18n</button>
        <button class="test-btn" onclick="step3_manualBind()">Step 3: Manual Bind</button>
        <button class="test-btn" onclick="step4_testClick()">Step 4: Test Click</button>
        <button class="test-btn" onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="debug-info">
        <h3>Real-time Log</h3>
        <div class="log" id="debugLog"></div>
    </div>

    <!-- ÊµãËØïËØ≠Ë®ÄÈÄâÊã©Âô® -->
    <div class="footer-language-selector">
        <label class="language-label">Language:</label>
        <div class="language-dropdown-wrapper">
            <button class="language-btn" id="languageBtn">
                <svg class="globe-icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
                </svg>
                <span id="currentLanguageText">English</span>
                <svg class="dropdown-arrow" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
            
            <div class="language-dropdown" id="languageDropdown">
                <button class="language-option" data-lang="en">
                    <span class="flag-icon">üá∫üá∏</span>
                    English
                </button>
                <button class="language-option" data-lang="zh-cn">
                    <span class="flag-icon">üá®üá≥</span>
                    ÁÆÄ‰Ωì‰∏≠Êñá
                </button>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${message}`);
            updateLog();
            console.log(message);
        }
        
        function updateLog() {
            document.getElementById('debugLog').textContent = logs.join('\n');
            document.getElementById('debugLog').scrollTop = document.getElementById('debugLog').scrollHeight;
        }
        
        function clearLog() {
            logs = [];
            updateLog();
        }
        
        function step1_checkElements() {
            log('=== STEP 1: Checking Elements ===');
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            const options = document.querySelectorAll('.language-option');
            
            log(`Language button: ${languageBtn ? 'FOUND' : 'NOT FOUND'}`);
            log(`Dropdown: ${dropdown ? 'FOUND' : 'NOT FOUND'}`);
            log(`Options count: ${options.length}`);
            
            if (languageBtn) {
                log(`Button tagName: ${languageBtn.tagName}`);
                log(`Button id: ${languageBtn.id}`);
                log(`Button classes: ${languageBtn.className}`);
                log(`Button display: ${getComputedStyle(languageBtn).display}`);
                log(`Button visibility: ${getComputedStyle(languageBtn).visibility}`);
                log(`Button pointer-events: ${getComputedStyle(languageBtn).pointerEvents}`);
            }
            
            if (dropdown) {
                log(`Dropdown classes: ${dropdown.className}`);
                log(`Dropdown opacity: ${getComputedStyle(dropdown).opacity}`);
                log(`Dropdown visibility: ${getComputedStyle(dropdown).visibility}`);
            }
        }
        
        function step2_checkI18n() {
            log('=== STEP 2: Checking i18n System ===');
            
            log(`I18nManager class exists: ${typeof I18nManager !== 'undefined'}`);
            log(`window.i18n exists: ${typeof window.i18n !== 'undefined'}`);
            
            if (window.i18n) {
                log(`i18n.currentLanguage: ${window.i18n.currentLanguage}`);
                log(`i18n.bindExistingLanguageSelectorEvents exists: ${typeof window.i18n.bindExistingLanguageSelectorEvents === 'function'}`);
                
                // Try to call the binding method
                try {
                    log('Calling bindExistingLanguageSelectorEvents...');
                    window.i18n.bindExistingLanguageSelectorEvents();
                    log('‚úÖ bindExistingLanguageSelectorEvents called successfully');
                } catch (error) {
                    log(`‚ùå bindExistingLanguageSelectorEvents error: ${error.message}`);
                }
            } else {
                log('‚ùå window.i18n not available');
            }
        }
        
        function step3_manualBind() {
            log('=== STEP 3: Manual Event Binding ===');
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            
            if (!languageBtn || !dropdown) {
                log('‚ùå Required elements not found');
                return;
            }
            
            // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
            const newBtn = languageBtn.cloneNode(true);
            languageBtn.parentNode.replaceChild(newBtn, languageBtn);
            
            log('üîß Adding manual click event listener...');
            
            newBtn.addEventListener('click', function(e) {
                log('üñ±Ô∏è MANUAL CLICK EVENT TRIGGERED!');
                e.preventDefault();
                e.stopPropagation();
                
                const isOpen = dropdown.classList.contains('open');
                log(`Current dropdown state: ${isOpen ? 'OPEN' : 'CLOSED'}`);
                
                if (isOpen) {
                    dropdown.classList.remove('open');
                    log('üîΩ Dropdown CLOSED');
                } else {
                    dropdown.classList.add('open');
                    log('üîº Dropdown OPENED');
                }
            });
            
            log('‚úÖ Manual event listener added');
        }
        
        function step4_testClick() {
            log('=== STEP 4: Testing Click ===');
            
            const languageBtn = document.getElementById('languageBtn');
            const dropdown = document.getElementById('languageDropdown');
            
            if (!languageBtn || !dropdown) {
                log('‚ùå Required elements not found');
                return;
            }
            
            log('üñ±Ô∏è Simulating click event...');
            
            const event = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });
            
            const beforeState = dropdown.classList.contains('open');
            log(`Before click - dropdown state: ${beforeState ? 'OPEN' : 'CLOSED'}`);
            
            languageBtn.dispatchEvent(event);
            
            setTimeout(() => {
                const afterState = dropdown.classList.contains('open');
                log(`After click - dropdown state: ${afterState ? 'OPEN' : 'CLOSED'}`);
                log(`State changed: ${beforeState !== afterState ? 'YES' : 'NO'}`);
            }, 100);
        }
        
        // ÁõëÂê¨ÊâÄÊúâÁÇπÂáª‰∫ã‰ª∂
        document.addEventListener('click', function(e) {
            if (e.target.id === 'languageBtn' || e.target.closest('#languageBtn')) {
                log(`üëÜ Click detected on language button: ${e.target.tagName}`);
            }
        });
        
        // ÁõëÂê¨ÂéüÂßãÁöÑÈº†Ê†á‰∫ã‰ª∂
        document.addEventListener('mousedown', function(e) {
            if (e.target.id === 'languageBtn' || e.target.closest('#languageBtn')) {
                log(`üñ±Ô∏è Mousedown on language button`);
            }
        });
        
        document.addEventListener('mouseup', function(e) {
            if (e.target.id === 'languageBtn' || e.target.closest('#languageBtn')) {
                log(`üñ±Ô∏è Mouseup on language button`);
            }
        });
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async function() {
            log('DOM loaded, starting initialization...');
            
            // Âä†ËΩΩ i18n
            try {
                if (typeof I18nManager === 'undefined') {
                    log('Loading i18n.js...');
                    const script = document.createElement('script');
                    script.src = 'js/i18n.js';
                    script.onload = async function() {
                        log('i18n.js loaded');
                        window.i18n = new I18nManager();
                        await window.i18n.init();
                        log('i18n initialized');
                    };
                    script.onerror = function() {
                        log('‚ùå Failed to load i18n.js');
                    };
                    document.head.appendChild(script);
                } else {
                    log('I18nManager already available');
                    window.i18n = new I18nManager();
                    await window.i18n.init();
                    log('i18n initialized');
                }
            } catch (error) {
                log(`‚ùå i18n initialization error: ${error.message}`);
            }
        });
    </script>
</body>
</html>